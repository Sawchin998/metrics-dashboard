apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: metrics-dashboard
data:
  database.host: "postgres-service"
  database.port: "5432"
  database.name: "metrics_db"
  app.environment: "production"
  app.worker.interval: "10"
  app.api.port: "3000"
  app.frontend.port: "80"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-init
  namespace: metrics-dashboard
data:
  init.sql: |
    CREATE TABLE IF NOT EXISTS metrics (
        id SERIAL PRIMARY KEY,
        value INTEGER NOT NULL CHECK (value >= 0 AND value <= 100),
        category VARCHAR(50) NOT NULL,
        timestamp TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
    );
    CREATE INDEX IF NOT EXISTS idx_metrics_category ON metrics(category);
    CREATE INDEX IF NOT EXISTS idx_metrics_timestamp ON metrics(timestamp);
    INSERT INTO metrics (value, category, timestamp) VALUES
    (72, 'temperature', NOW() - INTERVAL '5 minutes'),
    (45, 'sales', NOW() - INTERVAL '4 minutes'),
    (58, 'users', NOW() - INTERVAL '3 minutes'),
    (65, 'revenue', NOW() - INTERVAL '2 minutes'),
    (68, 'temperature', NOW() - INTERVAL '1 minute')
    ON CONFLICT DO NOTHING;
